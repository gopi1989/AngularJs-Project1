!function(){"use strict";function e(e,t,r,n,o){this.login=function(t,r){return e.auth(t,r)},this.getUserInfo=function(){return t.makeApiCall("/resources/users/user/")},this.getFileList=function(){return t.makeApiCall("/resources/files/")},this.uploadFile=function(e,t,n){return r.upload(e,t,n)},this.getFileStatus=function(e){return t.makeApiCall("/resources/files/"+e)},this.getSchoolList=function(){return n.getList()},this.isShibSchool=function(e){return n.isShib(e)},this.getRemoteReleaseStationList=function(e){return o.getStationList(e)},this.submitRemoteRelease=function(e,t){return o.submit(e,t)},this.cancelRemoteRelease=function(e){return o.cancel(e)},this.getRemoteReleaseStatus=function(e){return o.getStatus(e)}}function t(e,t,r){this.defaultAuthHeader="",this.makeApiCall=function(n,o,a){a=a||{};var i={method:a.data?"POST":"GET",url:r.API_BASE_URL+n,params:o,data:a.data,headers:{Authorization:a.authHeader||this.defaultAuthHeader,"Content-Type":a.contentType||"application/x-www-form-urlencoded"},transformRequest:function(e){var t="";return angular.forEach(e,function(e,r){t+=window.encodeURIComponent(r)+"="+window.encodeURIComponent(e)+"\n"}),t}};return a.data instanceof window.FormData&&(i.headers["Content-Type"]=void 0,i.transformRequest=angular.identity),t(i).then(function(e){return e.data},function(t){return e.reject(t.data)})}}function r(){var e={SUPPORTED_FILE_TYPES:["doc","docx","xls","xlsx","pdf","rtf","ppt","pptx","png","jpg","jpeg","bmp","gif","tiff","tif"],API_BASE_URL:"https://development-api.wepanow.com",CLIENT_ID:"wepa-printapp",CLIENT_SECRET:"printq2W#"};this.set=function(t){angular.extend(e,t)},this.$get=function(){return e}}function n(e){this.getStationList=function(t){return e.makeApiCall("/resources/kiosks/remote_release/list/keys/"+t.join(","))},this.submit=function(t,r){var n="/resources/kiosks/remote_release/submit/"+t.kiosk.name+"/release_code/"+r,o={key:t.stationKey};return e.makeApiCall(n,null,{data:o})},this.cancel=function(t){return e.makeApiCall("/resources/kiosks/remote_release/cancel/"+t)},this.getStatus=function(t){return e.makeApiCall("/resources/kiosks/remote_release/status/"+t)}}function o(e,t,r){this.getList=function(){return r.authUsingClientCredentials().then(function(){return t.makeApiCall("/resources/groups")})},this.isShib=function(e){return"SESSION"===e.authentication.type},this.getShibUrl=function(e){return e.authentication.shibbolethRedirectUrl}}function a(e,t,r,n){this.isSupportedFile=function(e){if(!angular.isString(e))return!1;var r=e.split(".").pop().toLowerCase(),n=e.split(".").length>1,o=-1!==t.SUPPORTED_FILE_TYPES.indexOf(r);return n&&o},this.upload=function(t,o,a){if(!this.isSupportedFile(o))return e.reject(r.INVALID_FILE_TYPE);var i=new window.FormData;return i.append("file",t),n.makeApiCall("/resources/files/upload",a,{data:i})}}function i(e,t,r,n){this.accessToken="",this.auth=function(r,o,a){if(!r||!o)return e.reject({error:n.INVALID_PARAMS,errorDescription:n.ERROR_EMPTY_CREDENTIALS});if(a&&this.accessToken)return e.resolve(this.accessToken);var i=this;return t.makeApiCall("/oauth/token",{grant_type:a?"client_credentials":"password",username:r,password:o},{data:{},authHeader:"Basic "+this.getBasicAuthToken()}).then(function(e){return i.accessToken=e.access_token,t.defaultAuthHeader="Bearer "+i.accessToken,i.accessToken},function(t){return e.reject(t)})},this.authUsingClientCredentials=function(){return this.auth(r.CLIENT_ID,r.CLIENT_SECRET,!0)},this.getBasicAuthToken=function(){return window.btoa(r.CLIENT_ID+":"+r.CLIENT_SECRET)}}function s(e,t,r){return{restrict:"E",scope:{school:"=",callback:"="},template:'<iframe ng-src="{{getShibUrl()}}"></iframe>',replace:!0,link:function(e,t){var n=t[0];t.bind("load",function(){var t=e.extractCredentials(n);t&&r.auth(t.email,t.cookie).then(e.callback)})},controller:["$scope",function(r){r.getShibUrl=function(){return e.trustAsResourceUrl(t.getShibUrl(r.school))},r.extractCredentials=function(e){try{var t=e.contentDocument.querySelector("#u-email"),r=e.contentDocument.querySelector("#u-cookie");return t&&r?{email:t.textContent,cookie:r.textContent}:null}catch(n){return null}}}]}}e.$inject=["wepaCoreAuth","wepaCoreApi","wepaCoreUpload","wepaCoreSchool","wepaCoreRemoteRelease"],angular.module("wepaCore",[]).service("wepaCore",e),t.$inject=["$q","$http","wepaCoreConfig","wepaCoreErrorMessages"],angular.module("wepaCore").service("wepaCoreApi",t),angular.module("wepaCore").provider("wepaCoreConfig",r),angular.module("wepaCore").constant("wepaCoreErrorMessages",{ERROR_EMPTY_CREDENTIALS:"Email and password should not be empty!",INVALID_PARAMS:"Invalid Parameters",INVALID_FILE_TYPE:"File type does not match"}),n.$inject=["wepaCoreApi"],angular.module("wepaCore").service("wepaCoreRemoteRelease",n),o.$inject=["$q","wepaCoreApi","wepaCoreAuth"],angular.module("wepaCore").service("wepaCoreSchool",o),a.$inject=["$q","wepaCoreConfig","wepaCoreErrorMessages","wepaCoreApi"],angular.module("wepaCore").service("wepaCoreUpload",a),i.$inject=["$q","wepaCoreApi","wepaCoreConfig","wepaCoreErrorMessages"],angular.module("wepaCore").service("wepaCoreAuth",i),s.$inject=["$sce","wepaCoreSchool","wepaCoreAuth"],angular.module("wepaCore").directive("wepaCoreShibAuth",s)}();